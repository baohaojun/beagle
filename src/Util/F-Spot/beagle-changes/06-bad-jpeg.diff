From: Debajyoti Bera <dbera.web@gmail.com>

Protect against bad jpeg files and files with exif dates in non-conformant syntax.

Index: Exif.cs
===================================================================
--- Exif.cs	(revision 3335)
+++ Exif.cs	(working copy)
@@ -267,8 +267,16 @@
 			string delimiters = " :";
 			string[] dt_data = dt.Split ( delimiters.ToCharArray(), 6 );
 			DateTime result;
-			result = new DateTime (Int32.Parse(dt_data[0]), Int32.Parse(dt_data[1]), Int32.Parse(dt_data[2]),
-					       Int32.Parse(dt_data[3]), Int32.Parse(dt_data[4]), Int32.Parse(dt_data[5]));
+			try {
+				result = new DateTime (Int32.Parse(dt_data[0]),
+					Int32.Parse(dt_data[1]),
+					Int32.Parse(dt_data[2]),
+					Int32.Parse(dt_data[3]),
+					Int32.Parse(dt_data[4]),
+					Int32.Parse(dt_data[5]));
+			} catch (FormatException) {
+				result = DateTime.MinValue;
+			}
 			
 			return result;
 		}	
Index: JpegHeader.cs
===================================================================
--- JpegHeader.cs	(revision 3343)
+++ JpegHeader.cs	(working copy)
@@ -504,7 +504,7 @@
 		bool at_image = false;
 
 		Marker marker = Marker.Load (stream);
-		if (marker.Type != JpegMarker.Soi)
+		if (marker == null || marker.Type != JpegMarker.Soi)
 			throw new System.Exception ("This doesn't appear to be a jpeg stream");
 		
 		this.Markers.Add (marker);
